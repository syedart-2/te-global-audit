<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Growth Audit Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- PapaParse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                        },
                        emerald: {
                            450: '#10b981',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .card { background-color: #1e293b; border: 1px solid #334155; border-radius: 0.75rem; padding: 1.5rem; }
        .metric-value { font-size: 1.5rem; font-weight: 700; color: #f8fafc; }
        .metric-label { font-size: 0.875rem; color: #94a3b8; }
        .badge { padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .badge-green { background-color: rgba(16, 185, 129, 0.2); color: #34d399; }
        .badge-red { background-color: rgba(239, 68, 68, 0.2); color: #f87171; }
        .badge-yellow { background-color: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #334155; }
        th { color: #94a3b8; font-weight: 600; font-size: 0.85rem; }
    </style>
</head>
<body class="min-h-screen p-6">

    <!-- Header -->
    <header class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-10">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight"><i class="fa-solid fa-chart-line text-emerald-400 mr-2"></i> Global Growth Audit</h1>
            <p class="text-slate-400 mt-1">Multi-Regional Performance Analysis & Strategy Engine</p>
        </div>
        <div class="mt-4 md:mt-0 flex gap-4">
            <label class="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition shadow-lg shadow-blue-900/50">
                <i class="fa-solid fa-upload mr-2"></i> Upload Report CSV
                <input type="file" id="csvInput" accept=".csv" class="hidden" onchange="handleFileUpload(this)">
            </label>
        </div>
    </header>

    <!-- Loading State -->
    <div id="loading" class="hidden text-center py-20">
        <i class="fa-solid fa-circle-notch fa-spin text-4xl text-blue-500"></i>
        <p class="mt-4 text-slate-400">Crunching data points...</p>
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="max-w-2xl mx-auto text-center py-20 border-2 border-dashed border-slate-700 rounded-xl">
        <i class="fa-solid fa-file-csv text-6xl text-slate-600 mb-4"></i>
        <h2 class="text-2xl font-semibold text-slate-300">No Data Loaded</h2>
        <p class="text-slate-500 mt-2">Upload the source CSV file to generate the audit.</p>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="max-w-7xl mx-auto hidden space-y-8">
        
        <!-- Section 1: Performance Overview -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Chart -->
            <div class="card lg:col-span-2">
                <h3 class="text-xl font-bold mb-4 border-b border-slate-700 pb-2">Language Performance Matrix</h3>
                <div class="h-80 relative">
                    <canvas id="performanceChart"></canvas>
                </div>
            </div>

            <!-- Conversion Metrics -->
            <div class="card overflow-y-auto max-h-[400px]">
                <h3 class="text-xl font-bold mb-4 border-b border-slate-700 pb-2">Follower Conversion Rate</h3>
                <p class="text-xs text-slate-500 mb-3">Formula: (Follows / Reach) * 1000</p>
                <div id="conversionList" class="space-y-3">
                    <!-- Injected via JS -->
                </div>
            </div>
        </div>

        <!-- Section 2: Regional Timing Audit -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
                <div class="flex justify-between items-center mb-4 border-b border-slate-700 pb-2">
                    <h3 class="text-xl font-bold"><i class="fa-regular fa-clock text-yellow-400 mr-2"></i>Native Timing Audit</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr>
                                <th>Region</th>
                                <th>Current Avg Post Time</th>
                                <th>Peak Reach Hour</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="timingTable">
                            <!-- Injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Golden Hour Comparison -->
            <div class="card bg-gradient-to-br from-slate-800 to-slate-900 border-blue-900/50">
                <h3 class="text-xl font-bold mb-4 text-blue-100">Golden Hour Strategy</h3>
                <div class="space-y-4">
                    <div class="p-4 bg-slate-800/50 rounded-lg border border-slate-700">
                        <h4 class="font-bold text-emerald-400 text-sm uppercase tracking-wide mb-1">Top Performer Benchmark (Uzbek/Persian)</h4>
                        <p class="text-slate-300 text-sm">High-performing regions define the "Golden Window". Currently, the peak engagement window globally aligns around <span id="globalPeak" class="font-bold text-white">--:--</span>.</p>
                    </div>
                    <div id="timingRecommendations" class="space-y-2">
                        <!-- Recs injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3: Title & Hook Audit -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Title & Hook Analysis</h3>
                <div class="flex gap-2">
                    <span class="badge badge-green">Strong Hooks</span>
                    <span class="badge badge-yellow">Average</span>
                    <span class="badge badge-red">Weak</span>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Hook Stats -->
                <div class="col-span-1 space-y-4">
                    <div class="p-4 bg-slate-800 rounded-lg">
                        <div class="text-slate-400 text-sm">Total Posts Audited</div>
                        <div class="text-2xl font-bold" id="totalPostsAudit">0</div>
                    </div>
                    <div class="p-4 bg-slate-800 rounded-lg">
                        <div class="text-slate-400 text-sm">Avg Hook Strength Score</div>
                        <div class="text-2xl font-bold" id="avgHookScore">0.0/3.0</div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold mb-3 text-sm text-slate-300">Viral Title Templates (Niche Adapted)</h4>
                        <ul class="text-sm space-y-2 text-slate-400">
                            <li class="p-2 bg-slate-800 rounded cursor-pointer hover:bg-slate-700 transition">1. "The secret to [Spiritual Benefit] that nobody tells you..."</li>
                            <li class="p-2 bg-slate-800 rounded cursor-pointer hover:bg-slate-700 transition">2. "Stop doing [Common Mistake] if you want [Result] ðŸ›‘"</li>
                            <li class="p-2 bg-slate-800 rounded cursor-pointer hover:bg-slate-700 transition">3. "Why does [Religion/Text] say X? (The Answer Shocked Me)"</li>
                            <li class="p-2 bg-slate-800 rounded cursor-pointer hover:bg-slate-700 transition">4. "This 10-second habit changed my prayer life forever..."</li>
                            <li class="p-2 bg-slate-800 rounded cursor-pointer hover:bg-slate-700 transition">5. "Are you making this mistake in [Topic]? ðŸ˜±"</li>
                        </ul>
                    </div>
                </div>

                <!-- Recent Posts Table -->
                <div class="col-span-2 overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Title / Description Snippet</th>
                                <th>Audit Rating</th>
                                <th>Reach</th>
                            </tr>
                        </thead>
                        <tbody id="hookTable">
                            <!-- Injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Section 4: Hashtag Intelligence -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
                <h3 class="text-xl font-bold mb-4">Hashtag Impact Correlation</h3>
                <div class="flex items-center justify-between p-4 bg-slate-800 rounded-lg mb-4">
                    <div>
                        <div class="text-sm text-slate-400">Avg Reach (With Tags)</div>
                        <div class="text-xl font-bold text-emerald-400" id="reachWithTags">0</div>
                    </div>
                    <div class="text-2xl text-slate-600">VS</div>
                    <div class="text-right">
                        <div class="text-sm text-slate-400">Avg Reach (No Tags)</div>
                        <div class="text-xl font-bold text-red-400" id="reachNoTags">0</div>
                    </div>
                </div>
                <p class="text-sm text-slate-400 italic" id="tagConclusion"></p>
            </div>
            
            <div class="card">
                <h3 class="text-xl font-bold mb-4">SEO Strategy: Recommended Tags</h3>
                <div class="h-64 overflow-y-auto pr-2 space-y-4" id="seoSuggestions">
                    <!-- Injected -->
                </div>
            </div>
        </div>

        <!-- Section 5: The Content Bridge (Roadmap) -->
        <div class="card border-emerald-450/30">
            <h3 class="text-xl font-bold mb-6 text-emerald-400"><i class="fa-solid fa-bridge mr-2"></i>The Content Bridge: Replication Strategy</h3>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Strategy Text -->
                <div class="col-span-1">
                    <h4 class="font-bold text-white mb-2">Immediate Fixes</h4>
                    <ul class="list-disc list-inside text-sm text-slate-300 space-y-2 mb-6" id="immediateFixes">
                        <li>Standardize publishing to <strong>Global Peak Hours</strong>.</li>
                        <li>Force <strong>Question Hooks</strong> on German & French accounts.</li>
                        <li>Implement <strong>3-5 Local Hashtags</strong> on every Indonesian post.</li>
                    </ul>
                    
                    <h4 class="font-bold text-white mb-2">The "Model" Approach</h4>
                    <p class="text-sm text-slate-400">
                        The <strong>Uzbek</strong> account is currently the Alpha performer. The strategy is to take its top 3 viral hits, translate the titles *conceptually* (not literally), and repost in low-performing regions.
                    </p>
                </div>

                <!-- Top 3 Posts Container -->
                <div class="col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4" id="topPostsContainer">
                    <!-- Cards injected -->
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. CONFIG & UTILS ---
        
        // Map common username patterns to clean Language Names
        const languageMap = {
            'teindonesian': 'Indonesian',
            'towardseternitydeutsch': 'German',
            'teuzbek': 'Uzbek',
            'tepersian': 'Persian',
            'tehindi': 'Hindi',
            'teurdu': 'Urdu',
            'tebengali': 'Bengali',
            'terussian': 'Russian',
            'tearabic': 'Arabic',
            'tefrench': 'French',
            'tespanish': 'Spanish',
            'teenglish': 'English'
        };

        const globalHashtags = ["#islam", "#muslim", "#faith", "#spirituality", "#peace", "#life", "#truth", "#purpose", "#reflection", "#wisdom"];

        // --- 2. DATA PROCESSING ---

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;

            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('emptyState').classList.add('hidden');

            Papa.parse(file, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    processData(results.data);
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                }
            });
        }

        function getLanguageName(row) {
            // Try username map
            let username = (row['Account username'] || '').toLowerCase().trim();
            if (languageMap[username]) return languageMap[username];

            // Try detecting from Account Name (e.g. "Towards Eternity - Indonesian")
            let name = row['Account name'] || '';
            let parts = name.split('-');
            if (parts.length > 1) return parts[1].trim();

            // Fallback
            return username || 'Unknown';
        }

        function parseNumber(val) {
            if (!val) return 0;
            return parseInt(val.toString().replace(/,/g, '')) || 0;
        }

        function processData(data) {
            const auditData = {};
            let allPosts = [];

            // 1. Aggregation Loop
            data.forEach(row => {
                const lang = getLanguageName(row);
                if (!auditData[lang]) {
                    auditData[lang] = {
                        posts: 0,
                        reach: 0,
                        shares: 0,
                        follows: 0,
                        comments: 0,
                        hours: {}, // For timing analysis
                        withTags: { reach: 0, count: 0 },
                        noTags: { reach: 0, count: 0 }
                    };
                }

                const reach = parseNumber(row['Reach']);
                const shares = parseNumber(row['Shares']);
                const follows = parseNumber(row['Follows']);
                const publishTime = row['Publish time']; // "12/26/2025 03:01"
                const desc = row['Description'] || "";

                // Metrics
                auditData[lang].posts++;
                auditData[lang].reach += reach;
                auditData[lang].shares += shares;
                auditData[lang].follows += follows;

                // Timing
                if (publishTime) {
                    const dateObj = new Date(publishTime);
                    if (!isNaN(dateObj)) {
                        const hour = dateObj.getHours();
                        if (!auditData[lang].hours[hour]) auditData[lang].hours[hour] = { reach: 0, count: 0 };
                        auditData[lang].hours[hour].reach += reach;
                        auditData[lang].hours[hour].count++;
                    }
                }

                // Hashtags
                const hasTags = desc.includes('#');
                if (hasTags) {
                    auditData[lang].withTags.reach += reach;
                    auditData[lang].withTags.count++;
                } else {
                    auditData[lang].noTags.reach += reach;
                    auditData[lang].noTags.count++;
                }

                // Store simplified row for audits
                row.processedLang = lang;
                row.cleanReach = reach;
                allPosts.push(row);
            });

            renderCharts(auditData);
            renderTimingAudit(auditData);
            renderHookAudit(allPosts);
            renderHashtagAudit(auditData);
            renderRoadmap(allPosts, auditData);
        }

        // --- 3. RENDERING LOGIC ---

        function renderCharts(auditData) {
            const labels = Object.keys(auditData);
            const reachData = labels.map(l => auditData[l].reach);
            const shareRates = labels.map(l => {
                const r = auditData[l].reach;
                return r > 0 ? ((auditData[l].shares / r) * 100).toFixed(2) : 0;
            });

            // 1. Main Chart
            const ctx = document.getElementById('performanceChart').getContext('2d');
            if(window.myChart) window.myChart.destroy(); // Prevent canvas reuse error

            window.myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Total Reach',
                            data: reachData,
                            backgroundColor: '#3b82f6',
                            yAxisID: 'y',
                            borderRadius: 4
                        },
                        {
                            label: 'Share Rate (%)',
                            data: shareRates,
                            type: 'line',
                            borderColor: '#10b981',
                            backgroundColor: '#10b981',
                            borderWidth: 2,
                            yAxisID: 'y1',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { 
                            type: 'linear', 
                            display: true, 
                            position: 'left',
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        },
                        y1: { 
                            type: 'linear', 
                            display: true, 
                            position: 'right', 
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#10b981' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#94a3b8' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#cbd5e1' } }
                    }
                }
            });

            // 2. Conversion List
            const list = document.getElementById('conversionList');
            list.innerHTML = '';
            
            // Calculate and Sort
            const conversionArr = labels.map(l => {
                const rate = auditData[l].reach > 0 ? (auditData[l].follows / auditData[l].reach) * 1000 : 0;
                return { lang: l, rate: rate };
            }).sort((a,b) => b.rate - a.rate);

            conversionArr.forEach(item => {
                const isLow = item.rate < 0.5; // Threshold
                const colorClass = isLow ? 'text-red-400' : 'text-emerald-400';
                const warning = isLow ? '<i class="fa-solid fa-triangle-exclamation text-red-500 ml-2" title="Low Conversion"></i>' : '';
                
                list.innerHTML += `
                    <div class="flex justify-between items-center p-3 bg-slate-800 rounded border border-slate-700">
                        <span class="font-medium text-slate-300">${item.lang}</span>
                        <div class="flex items-center">
                            <span class="font-bold ${colorClass} mr-2">${item.rate.toFixed(2)}</span>
                            <span class="text-xs text-slate-500">follows/1k reach</span>
                            ${warning}
                        </div>
                    </div>
                `;
            });
        }

        function renderTimingAudit(auditData) {
            const table = document.getElementById('timingTable');
            table.innerHTML = '';
            
            let globalPeakHour = 0;
            let maxGlobalReach = 0;
            const hourTotals = {};

            // Calculate per language peaks and build global heatmap
            Object.keys(auditData).forEach(lang => {
                let bestHour = -1;
                let maxReach = -1;
                let totalHours = 0;
                let postCount = 0;

                Object.keys(auditData[lang].hours).forEach(h => {
                    const stats = auditData[lang].hours[h];
                    const avgReach = stats.reach / stats.count;
                    
                    // Local Best
                    if (avgReach > maxReach) {
                        maxReach = avgReach;
                        bestHour = h;
                    }

                    // For Global calculation
                    if(!hourTotals[h]) hourTotals[h] = 0;
                    hourTotals[h] += stats.reach;

                    totalHours += (parseInt(h) * stats.count);
                    postCount += stats.count;
                });

                const avgPostHour = postCount > 0 ? Math.round(totalHours / postCount) : 0;

                // Status logic
                const isMisaligned = Math.abs(avgPostHour - bestHour) > 3;
                const statusHtml = isMisaligned 
                    ? `<span class="badge badge-red">Misaligned</span>` 
                    : `<span class="badge badge-green">Optimized</span>`;

                table.innerHTML += `
                    <tr>
                        <td class="font-medium text-slate-300">${lang}</td>
                        <td class="text-slate-400">${formatHour(avgPostHour)}</td>
                        <td class="text-emerald-400 font-bold">${bestHour > -1 ? formatHour(bestHour) : 'N/A'}</td>
                        <td>${statusHtml}</td>
                    </tr>
                `;
            });

            // Find Global Peak
            let bestGlobalH = -1;
            let highestTotal = -1;
            for(const h in hourTotals) {
                if(hourTotals[h] > highestTotal) {
                    highestTotal = hourTotals[h];
                    bestGlobalH = h;
                }
            }
            document.getElementById('globalPeak').innerText = formatHour(bestGlobalH);

            // Recommendations for low performers
            const recs = document.getElementById('timingRecommendations');
            recs.innerHTML = '';
            ['German', 'Indonesian', 'French'].forEach(target => {
                if(auditData[target]) {
                    // Find Uzbek's peak (Proxy for "Gold Standard")
                    let benchmarkHour = 0;
                    if(auditData['Uzbek']) {
                         // Simplify: Just take Uzbek's best hour
                         let maxR = -1;
                         Object.keys(auditData['Uzbek'].hours).forEach(h => {
                            if ((auditData['Uzbek'].hours[h].reach/auditData['Uzbek'].hours[h].count) > maxR) {
                                maxR = (auditData['Uzbek'].hours[h].reach/auditData['Uzbek'].hours[h].count);
                                benchmarkHour = h;
                            }
                         });
                    }

                    recs.innerHTML += `
                        <div class="p-3 bg-slate-800 rounded border-l-4 border-yellow-500">
                            <div class="flex justify-between">
                                <span class="font-bold text-slate-200">${target} Fix</span>
                                <span class="text-xs text-yellow-500 font-bold">TIMING ALERT</span>
                            </div>
                            <p class="text-xs text-slate-400 mt-1">
                                Currently posting scattered. Shift schedule to <strong>${formatHour(benchmarkHour)} - ${formatHour(parseInt(benchmarkHour)+2)}</strong> to align with global viral waves.
                            </p>
                        </div>
                    `;
                }
            });
        }

        function formatHour(h) {
            h = parseInt(h);
            const suffix = h >= 12 ? "PM" : "AM";
            const val = (h % 12) || 12;
            return `${val}:00 ${suffix}`;
        }

        function renderHookAudit(allPosts) {
            const table = document.getElementById('hookTable');
            table.innerHTML = '';
            
            let totalScore = 0;
            let count = 0;

            // Sort by Date (newest first) for the table, limit to 10
            const recentPosts = [...allPosts].sort((a,b) => new Date(b['Publish time']) - new Date(a['Publish time'])).slice(0, 10);

            recentPosts.forEach(post => {
                const desc = post['Description'] || "";
                const cleanReach = post['cleanReach'];
                
                // Audit Logic
                const hasQuestion = desc.includes('?');
                const hasEmoji = /[\p{Extended_Pictographic}]/u.test(desc);
                const isShort = desc.length < 150;
                
                let score = 0;
                if(hasQuestion) score++;
                if(hasEmoji) score++;
                if(isShort) score++;

                totalScore += score;
                count++;

                let rating = 'Weak';
                let badgeClass = 'badge-red';
                if(score === 2) { rating = 'Average'; badgeClass = 'badge-yellow'; }
                if(score === 3) { rating = 'Strong'; badgeClass = 'badge-green'; }

                table.innerHTML += `
                    <tr>
                        <td class="text-xs text-slate-400">${post.processedLang}</td>
                        <td>
                            <div class="text-sm text-slate-200 truncate w-64" title="${desc}">${desc}</div>
                        </td>
                        <td><span class="badge ${badgeClass}">${rating}</span></td>
                        <td class="text-sm font-mono">${cleanReach.toLocaleString()}</td>
                    </tr>
                `;
            });

            document.getElementById('totalPostsAudit').innerText = allPosts.length;
            document.getElementById('avgHookScore').innerText = count > 0 ? (totalScore / count).toFixed(1) + "/3.0" : "0.0";
        }

        function renderHashtagAudit(auditData) {
            let globalWith = 0;
            let globalWithCount = 0;
            let globalNo = 0;
            let globalNoCount = 0;

            Object.values(auditData).forEach(d => {
                globalWith += d.withTags.reach;
                globalWithCount += d.withTags.count;
                globalNo += d.noTags.reach;
                globalNoCount += d.noTags.count;
            });

            const avgWith = globalWithCount > 0 ? Math.round(globalWith / globalWithCount) : 0;
            const avgNo = globalNoCount > 0 ? Math.round(globalNo / globalNoCount) : 0;

            document.getElementById('reachWithTags').innerText = avgWith.toLocaleString();
            document.getElementById('reachNoTags').innerText = avgNo.toLocaleString();

            const diff = avgWith - avgNo;
            const conclusion = document.getElementById('tagConclusion');
            if(diff > 0) {
                conclusion.innerText = `Hashtags provide a +${Math.round((diff/avgNo)*100)}% lift in Reach. Essential for discovery.`;
                conclusion.classList.add('text-emerald-400');
            } else {
                conclusion.innerText = `Hashtags are currently underperforming or irrelevant content is being tagged.`;
                conclusion.classList.add('text-yellow-400');
            }

            // Suggestions
            const suggestionContainer = document.getElementById('seoSuggestions');
            suggestionContainer.innerHTML = '';
            
            Object.keys(auditData).forEach(lang => {
                const localTags = `#${lang.toLowerCase()} #viral${lang.substring(0,3)} #fyp${lang.substring(0,3)}`;
                suggestionContainer.innerHTML += `
                    <div class="p-3 bg-slate-800 rounded border border-slate-700">
                        <h5 class="text-sm font-bold text-white mb-1">${lang}</h5>
                        <div class="text-xs text-slate-400 break-words">
                            <span class="text-blue-400">Global:</span> ${globalHashtags.slice(0,5).join(' ')}...
                        </div>
                        <div class="text-xs text-slate-400 mt-1">
                            <span class="text-emerald-400">Local:</span> ${localTags}
                        </div>
                    </div>
                `;
            });
        }

        function renderRoadmap(allPosts, auditData) {
            // Find "Uzbek" top 3 posts
            const topPosts = allPosts
                .filter(p => p.processedLang === 'Uzbek') // Target specific language
                .sort((a,b) => b.cleanReach - a.cleanReach)
                .slice(0, 3);
            
            // Fallback if no Uzbek data
            const displayPosts = topPosts.length > 0 ? topPosts : allPosts.sort((a,b) => b.cleanReach - a.cleanReach).slice(0, 3);

            const container = document.getElementById('topPostsContainer');
            container.innerHTML = '';

            displayPosts.forEach((post, index) => {
                const desc = post['Description'] || "No description";
                // Simple regex to grab first line or short snippet
                const title = desc.split('\n')[0].substring(0, 50) + "...";
                
                container.innerHTML += `
                    <div class="bg-slate-800 rounded-lg p-4 border border-slate-700 relative overflow-hidden group">
                        <div class="absolute top-0 right-0 bg-yellow-500 text-black text-xs font-bold px-2 py-1 rounded-bl">
                            #${index + 1} Viral
                        </div>
                        <div class="text-xs text-emerald-400 font-mono mb-2">${post.cleanReach.toLocaleString()} Reach</div>
                        <h5 class="font-bold text-white text-sm mb-2">"${title}"</h5>
                        <div class="text-xs text-slate-500 mb-3">
                            <i class="fa-regular fa-calendar mr-1"></i> ${post['Publish time'].split(' ')[0]}
                        </div>
                        <div class="mt-2 pt-2 border-t border-slate-700">
                            <p class="text-xs text-slate-400"><strong class="text-blue-400">Action:</strong> Translate hook concept & repost at Peak Hour.</p>
                        </div>
                    </div>
                `;
            });
        }

    </script>
</body>
</html>
